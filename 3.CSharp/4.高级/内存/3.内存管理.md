# 内存管理

# 栈区

C#中栈是**编译期间就分配好的内存空间**，因此你的代码中必须就栈的大小有明确的定义。

栈区内存无需我们管理，也不受GC管理，**栈顶元素使用完毕弹出就会立即释放**。

# 堆区

堆区是程序运行期间动态分配的内存空间，

你可以根据程序的运行情况确定要分配的堆内存的大小。

在**C#中堆区内存由GC(Garbage collection:**[**垃圾收集器**](https://zhida.zhihu.com/search?content_id=113355503&content_type=Article&match_order=1&q=垃圾收集器&zhida_source=entity)**)负责清理**，**当对象超出作用域范围或者对象失去指向的引用地址**，就会在一定时间内进行统一的处理，无需程序员手动处理。

当对象不再使用时，这个**被存储在堆栈中的引用变量将被删除**，但是从上述机制可以看出，**在托管堆中这个引用指向的对象仍然存在，其空间何时被释放取决垃圾收集器而不是引用变量失去作用域时。**

在使用电脑的过程中大家可能都有过这种经验：

- 电脑用久了以后程序运行会变得越来越慢，其中一个重要原因就是**系统中存在大量内存碎片**，就是因为程序反复在堆栈中创建和释入变量，久而久之可用变量在内存中将不再是连续的内存空间，为了寻址这些变量也会增加系统开销。

在.net中这种情形将得到很大改善，这是因为**有了垃圾收集器的工作，垃圾收集器将会压缩托管堆的内存空间，保证可用变量在一个连续的内存空间内，同时将堆栈中引用变量中的地址改为新的地址，这将会带来额外的系统开销**，但是，其带来的好处将会抵消这种影响，而另外一个好处是，程序员将不再花上大量的心思在内存泄露问题上。

垃圾收集器除了会压缩托管堆、更新引用地址、还会维护托管堆的信息列表。
