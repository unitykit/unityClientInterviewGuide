# æ³›å‹

### **æ³›å‹æ˜¯ä»€ä¹ˆï¼Ÿ**

**æ³›å‹ï¼ˆGenericsï¼‰** æ˜¯C#ä¸­çš„**ç±»å‹å‚æ•°åŒ–æŠ€æœ¯**ï¼Œå…è®¸ç¼–å†™å¯å¤„ç†å¤šç§æ•°æ®ç±»å‹çš„ä»£ç ï¼Œé¿å…ä¸ºæ¯ç§ç±»å‹é‡å¤ç¼–å†™é€»è¾‘ã€‚

**æ ¸å¿ƒæ€æƒ³**ï¼šç”¨å ä½ç¬¦`T`è¡¨ç¤ºç±»å‹ï¼Œä½¿ç”¨æ—¶å†æŒ‡å®šå…·ä½“ç±»å‹ã€‚

![img](assets/1753688533154-dbd889ee-bb5f-4a87-b0c5-251c215ac009.png)

![img](assets/1753688290943-b8d86574-55fe-4b70-b596-8d5992d4540c.png)

**ç¤ºä¾‹å¯¹æ¯”**ï¼š

```js
// éæ³›å‹ï¼šåªèƒ½å¤„ç†intç±»å‹
public class IntList { 
    private int[] items; 
}

// æ³›å‹ï¼šå¯å¤„ç†ä»»æ„ç±»å‹
public class List<T> { 
    private T[] items;  // Tæ˜¯ç±»å‹å ä½ç¬¦
}
```

ğŸ’¡ å½“è°ƒç”¨`List<int>`æ—¶ï¼Œç¼–è¯‘å™¨å°†`T`æ›¿æ¢ä¸º`int`ï¼Œç”Ÿæˆä¸“ç”¨ç±»ã€‚

### **æ³›å‹çš„æ ¸å¿ƒç±»å‹**

#### **(1) æ³›å‹ç±»**

```js
public class Box<T> {
    private T _value;
    public void SetValue(T value) => _value = value;
    public T GetValue() => _value;
}

// ä½¿ç”¨
var intBox = new Box<int>();
intBox.SetValue(123);
```

ä¸€ä¸ªç±»å¯æ”¯æŒå¤šç§ç±»å‹å‚æ•°ï¼Œå¦‚`Dictionary<TKey, TValue>`ã€‚

#### **(2) æ³›å‹æ–¹æ³•**

```js
public static T Max<T>(T a, T b) where T : IComparable<T> {
    return a.CompareTo(b) > 0 ? a : b;
}

// è°ƒç”¨ï¼ˆç±»å‹è‡ªåŠ¨æ¨æ–­ï¼‰
int max = Max(10, 20); // Tè¢«æ¨æ–­ä¸ºint
```

å³ä½¿éæ³›å‹ç±»ä¸­ä¹Ÿå¯å®šä¹‰æ³›å‹æ–¹æ³•ã€‚

#### **(3) æ³›å‹æ¥å£**

```js
public interface IRepository<T> {
    void Add(T entity);
    T GetById(int id);
}

public class UserRepository : IRepository<User> {
    // å®ç°æ¥å£æ–¹æ³•
}
```

æ¥å£å¥‘çº¦å¯å¤ç”¨ï¼Œå®ç°ç±»æŒ‡å®šå…·ä½“ç±»å‹ã€‚

------

### **æ³›å‹çº¦æŸ**

çº¦æŸç¡®ä¿ç±»å‹å‚æ•°ç¬¦åˆè¦æ±‚ï¼Œæå‡å®‰å…¨æ€§

![img](assets/1753688249670-eea3b69d-db8d-42dd-bf6a-395e32d5ff1b.png)

![img](assets/1753688571421-6bad730f-fc3b-4fd6-b20c-a649e8869ffb.png)

**ç¤ºä¾‹**

```js
public class DataProcessor<T> where T : class, IEntity, new() {
    public void Process() {
        var obj = new T(); // å®‰å…¨åˆ›å»ºå®ä¾‹
        obj.Id = 1;       // å¯è®¿é—®IEntityæˆå‘˜
    }
}
```

è‹¥æ— çº¦æŸï¼Œ`new T()`æˆ–`obj.Id`ä¼šç¼–è¯‘æŠ¥é”™ã€‚

------

### **æ³›å‹æ ¸å¿ƒä¼˜åŠ¿**

| **ä¼˜åŠ¿**     | **è¯´æ˜**                           | **ç¤ºä¾‹å¯¹æ¯”**                                                 |
| ------------ | ---------------------------------- | ------------------------------------------------------------ |
| **ç±»å‹å®‰å…¨** | ç¼–è¯‘æ—¶æ£€æŸ¥ç±»å‹é”™è¯¯ï¼Œé¿å…è¿è¡Œæ—¶å¼‚å¸¸ | `List<int>`æ·»åŠ å­—ç¬¦ä¸²ä¼šæŠ¥é”™ vs `ArrayList`æ·»åŠ ä»»æ„ç±»å‹å¯¼è‡´è¿è¡Œæ—¶é”™è¯¯ |
| **æ€§èƒ½ä¼˜åŒ–** | é¿å…å€¼ç±»å‹çš„è£…ç®±/æ‹†ç®±æ“ä½œ          | `List<int>`ç›´æ¥æ“ä½œæ ˆå†…å­˜ï¼Œ`ArrayList`éœ€è£…ç®±åˆ°å †             |
| **ä»£ç å¤ç”¨** | ä¸€å¥—é€»è¾‘å¤„ç†å¤šç§ç±»å‹               | `Max<T>`æ–¹æ³•æ”¯æŒint/string/doubleç­‰                          |
| **å¯è¯»æ€§**   | ä»£ç æ„å›¾æ˜ç¡®ï¼Œå‡å°‘ç±»å‹è½¬æ¢å™ªéŸ³     | `Dictionary<string, User>` vs `Hashtable`                    |

------

### **å®é™…åº”ç”¨åœºæ™¯**

#### **(1) é›†åˆç±»ï¼ˆæœ€å¸¸ç”¨ï¼‰**

```js
List<int> numbers = new List<int>();  // åŠ¨æ€æ•°ç»„
Dictionary<string, User> userCache;   // é”®å€¼å¯¹
Queue<Order> orderQueue;              // å…ˆè¿›å…ˆå‡º
```

ä¼˜å…ˆä½¿ç”¨æ³›å‹é›†åˆè€Œé`ArrayList`/`Hashtable`ã€‚

#### **(2) æ³›å‹ç¼“å­˜**

```js
public static class Cache<T> {
    static Cache() {
        // æ¯ä¸ªTç±»å‹ç”Ÿæˆç‹¬ç«‹ç¼“å­˜
    }
    public static T Get(string key) { ... }
}
```

æ¯”å­—å…¸ç¼“å­˜æ›´å¿«ï¼Œå› ç±»å‹ä¿¡æ¯åœ¨ç¼–è¯‘æ—¶ç¡®å®šã€‚

#### **(3) å·¥å‚æ¨¡å¼**

```js
public class Factory<T> where T : new() {
    public T Create() => new T();
}
var userFactory = new Factory<User>();
User user = userFactory.Create();
```

çº¦æŸ`new()`ç¡®ä¿å¯å®ä¾‹åŒ–ã€‚

### **é«˜çº§ç‰¹æ€§ï¼šåå˜ä¸é€†å˜**

- **åå˜ï¼ˆoutï¼‰**ï¼šå­ç±»æ³›å‹â†’çˆ¶ç±»æ³›å‹ï¼ˆå®‰å…¨ï¼‰ 

```js
IEnumerable<Dog> dogs = new List<Dog>();
IEnumerable<Animal> animals = dogs; // åˆæ³•
```

- **é€†å˜ï¼ˆinï¼‰**ï¼šçˆ¶ç±»æ³›å‹â†’å­ç±»æ³›å‹ï¼ˆéœ€è°¨æ…ï¼‰ 

```js
Action<Animal> feedAnimal = a => a.Feed();
Action<Dog> feedDog = feedAnimal; // åˆæ³•
```

ä»…é€‚ç”¨äºæ¥å£/å§”æ‰˜ï¼Œé€šè¿‡`out`/`in`å…³é”®å­—å®ç°ã€‚
