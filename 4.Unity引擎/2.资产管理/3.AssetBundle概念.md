# AssetBundle概念

## 面试题

1. **什么是AssetBundle？**

Unity提供的资源打包格式，包含序列化后的游戏资源（模型、纹理、预制体等），支持压缩与动态加载。

2. **AssetBundle与Resources区别？**

- Resources：静态打包在应用内，**Resources**：仅适合小型静态资源（如配置表），不可热更。
- AssetBundle：支持网络下载与版本管理，灵活性强，适合大型项目、需热更新的场景。

![img](assets/1754383306548-be2a53d3-2241-442d-805f-e78e3d522d04.png)

3. **AssetBundle加载与卸载？**

![img](assets/1754387466673-0df55aa9-1b72-4c3c-b66d-1d3bab1b324c.png)

4. **加载方式都有哪一些？**

![img](assets/1754387499705-15e15a77-592b-464b-a3c4-461d3a113e4a.png)

5. **卸载策略都有哪一些？**

- `Unload(false)`：仅卸载AB包，保留已加载资源（需手动管理引用）。
- `Unload(true)`：强制卸载AB包及所有资源（易引发材质丢失）

6. **AB 包加载失败如何解决？**

![img](assets/1754387577413-85d61c7d-3153-49d3-a686-1af6ab940028.png)

7. **版本冲突**

使用`BuildAssetBundleOptions.AppendHashToAssetBundleName`添加哈希值校验。

8. **内存泄漏**

及时调用`Unload`，避免重复加载相同AB包。

9. **资源冗余**

通过`AssetBundleBrowser Tool`检测重复打包资源

![img](assets/1754387668751-cf786880-529b-45af-a45e-ff50e3de90fc.png)

## 概念

AssetBundle（AB包）是Unity提供的**资源打包技术**，将游戏资源（预制体、场景、材质等）序列化为二进制文件，支持动态加载与热更新。

Asset Bundle： https://docs.unity3d.com/Manual/AssetBundlesIntro.html

**特点**

- 资源按需加载，减少内存压力
- 支持LZMA/LZ4压缩，优化下载速度
- 依赖关系管理，避免资源冗余

## AssetBundle工作流程

#### 打包流程

1. 在Inspector中为资源设置AB名称（如`ui/icon`）
2. 使用`BuildPipeline.BuildAssetBundles()`生成包文件

```js
// 同步加载
AssetBundle ab = AssetBundle.LoadFromFile(path);
GameObject prefab = ab.LoadAsset<GameObject>("Player");

// 异步加载（推荐）
StartCoroutine(LoadABAsync("https://server.com/characters"));
IEnumerator LoadABAsync(string url) {
    UnityWebRequest request = UnityWebRequestAssetBundle.GetAssetBundle(url);
    yield return request.SendWebRequest();
    AssetBundle remoteAB = DownloadHandlerAssetBundle.GetContent(request);
    [3,6](@ref)
}
```

![img](assets/1754383205046-1e57f325-4c5e-4fa6-a887-06bbea46b741.png)

#### **加载与卸载**

```csharp
// 同步加载
AssetBundle ab = AssetBundle.LoadFromFile(path);
GameObject prefab = ab.LoadAsset<GameObject>("Player");

// 异步加载（推荐）
StartCoroutine(LoadABAsync("https://server.com/characters"));
IEnumerator LoadABAsync(string url) {
    UnityWebRequest request = UnityWebRequestAssetBundle.GetAssetBundle(url);
    yield return request.SendWebRequest();
    AssetBundle remoteAB = DownloadHandlerAssetBundle.GetContent(request);
    [3,6](@ref)
}
```

![img](https://cdn.nlark.com/yuque/0/2025/png/35926903/1754383402114-610a48a4-a619-463d-85e4-c073a2088e85.png?x-oss-process=image%2Fwatermark%2Ctype_d3F5LW1pY3JvaGVp%2Csize_14%2Ctext_56iL5bqP5ZGYIC0g6Zi_5biD5ouJ%2Ccolor_FFFFFF%2Cshadow_50%2Ct_80%2Cg_se%2Cx_10%2Cy_10)

## 资源热更新

无需重新发布应用，即可更新游戏内容（如活动场景、角色皮肤）。

![img](assets/1754383075902-656a75af-ff99-4ca8-acb3-5717a88b630f.png)

## 分包策略

- 公共资源（如Shader）独立打包
- 按功能模块划分（UI/角色/场景）
- 按更新频率分离

![img](assets/1754383145724-96c28a34-d3d8-4e8e-9966-aaf61229bd15.png)

## 内存优化

仅加载当前需要的资源，及时卸载闲置AB包，避免内存浪费

![img](assets/1754383118596-e6d0fe47-05cc-4113-b3a6-50a7c86337cc.png)

## 常见问题

![img](assets/1754383282520-07364e2e-8e10-483f-9b73-adf82dc91a72.png)

1. **压缩选择**：

- **LZ4**：运行时快速解压（推荐）
- **LZMA**：高压缩率，适合初始包

2. **缓存机制**：使用`UnityWebRequestAssetBundle`缓存下载的AB包

3. **依赖分析**：通过`AssetDatabase.GetDependencies()`避免重复打包
