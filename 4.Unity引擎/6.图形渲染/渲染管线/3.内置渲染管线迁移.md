# 内置渲染管线简易迁移

## 面试

1. 如何从内置渲染管线迁移到URP/HDRP？

## 准备工作

1. **项目备份**

- 使用版本控制（如Git/SVN）或手动备份项目文件夹，避免不可逆的材质或着色器损坏。

2. **版本兼容性检查**

- URP/HDRP需Unity 2019.3或更高版本，建议使用2021 LTS或更新版本以获得稳定支持。

3. **安装对应Package**

- 通过`Window > Package Manager`安装`Universal RP`（URP）或`High Definition RP`（HDRP）包。

## 具体步骤

1. **创建URP配置资产**

- 右键项目窗口：`Create > Rendering > Universal Render Pipeline > Pipeline Asset`，生成URP主配置和渲染器资产。

2. **切换默认管线**

- 打开`Edit > Project Settings > Graphics`，将`Scriptable Render Pipeline Settings`字段指向刚创建的URP资产。

3. **材质与着色器转换**

- **自动转换**：使用`Edit > Render Pipeline > Universal Render Pipeline > Upgrade Project Materials`批量升级内置材质到URP兼容版本。
- **手动修复**：自定义着色器需重写为HLSL语言，替换`CGPROGRAM`为`HLSLPROGRAM`，并更新头文件（如`UnityCG.cginc`改为URP的`Core.hlsl`）。

4. **光照与阴影调整**

- URP的光照模型与内置管线不同，需重新烘焙光照贴图或调整光源参数（如强度、阴影分辨率）。

## 迁移到HDRP的特殊注意事项

1. **硬件要求**

- HDRP仅支持DX11/12、Vulkan或Metal的高端GPU，需确认目标平台兼容性。

2. **材质升级**

- HDRP材质需使用`HDRP/Lit`等专用着色器，旧材质可能显示为粉色，需通过`Upgrade to HDRP`选项或手动替换。

3. **后处理与特效**

- HDRP的后处理堆栈（如体积光、屏幕空间反射）需重新配置，部分内置特效（如旧版粒子系统）需改用HDRP兼容版本。

|                      | **原因**                    | **解决方案**                                                 |
| -------------------- | --------------------------- | ------------------------------------------------------------ |
| 材质显示粉色         | 着色器不兼容                | 使用URP/HDRP内置着色器（如`Universal Render Pipeline/Lit`）或通过Shader Graph重构。 |
| 光照表现异常         | URP/HDRP光照模型差异        | 重新调整光源参数，或使用`Lighting Settings`重新烘焙GI。      |
| 性能下降             | SRP Batcher未启用或配置不当 | 在URP资产中启用`SRP Batcher`，并确保着色器使用`CBUFFER`封装材质属性。 |
| 相机深度失效         | URP/HDRP相机堆栈规则变化    | 主相机设为`Base`，其他相机设为`Overlay`并加入主相机的`Stack`。 |
| 自定义Shader功能丢失 | HLSL语法或API变更           | 参考URP/HDRP官方文档重写逻辑，或使用`Custom Function`节点封装原有代码。 |
