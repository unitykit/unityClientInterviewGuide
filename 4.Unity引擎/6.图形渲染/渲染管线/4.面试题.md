# 面试题

### 1. 什么是渲染管线？Unity中有哪些主要类型？

渲染管线是将3D场景数据转换为2D屏幕像素的流程，包括几何处理、光栅化、着色等阶段。

包含以下类型：

- **内置管线**：固定流程，兼容旧平台。
- **URP（Universal Render Pipeline）**：轻量级，跨平台优化。
- **HDRP（High Definition Render Pipeline）**：高端画质，支持光追等高级特性。
- **自定义SRP**：通过C#脚本完全控制渲染逻辑。

### 2. SRP（Scriptable Render Pipeline）的优势是什么？

- **灵活性**：可自定义剔除、排序、渲染Pass等流程。
- **性能优化**：支持SRP Batcher、GPU Instancing等。
- **模块化设计**：通过`RenderPipelineAsset`和`RenderPipeline`类实现配置与执行分离。

### 3. 如何实现自定义渲染管线？

**步骤**：

1. 继承`RenderPipelineAsset`创建配置资产。
2. 实现`RenderPipeline`类，重写`Render`方法管理渲染流程（如剔除、绘制、后处理）。
3. 使用`ScriptableRenderContext`和`CommandBuffer`提交GPU指令。

**示例代码** 

```csharp
public class CustomRP : RenderPipeline {
    protected override void Render(ScriptableRenderContext context, Camera[] cameras) {
        foreach (var camera in cameras) {
            // 1. 剔除 2. 绘制 3. 后处理
            context.Submit();
        }
    }
}
```

### 4. URP和HDRP的核心区别？

**URP**

- 目标平台：移动端/中低端PC。
- 特性：轻量级PBR、简化版光照模型。

**HDRP**

- 目标平台：高端PC/主机。
- 特性：实时光追、体积雾、物理级材质。

### 5. 如何在SRP中实现后处理效果（如Bloom）？

**流程**：

1. 创建`RendererFeature`和`RenderPass`。
2. 使用`CommandBuffer.Blit`在临时RT间传递图像数据。
3. 编写Shader实现高斯模糊与亮度阈值过滤。

### 6. 如何优化渲染管线的DrawCall？

- **SRP Batcher**：合并相同材质的DrawCall（需Shader支持`CBUFFER`）。
- **GPU Instancing**：单次DrawCall渲染多个相同网格的不同实例。
- **动态合批**：自动合并小型网格（限制较多）。

### 7. URP中如何减少Overdraw？

- **分层渲染**：先渲染不透明物体（从近到远），再渲染透明物体（从远到近）。
- **Early-Z**：通过深度预 Pass 提前剔除不可见像素。

### 8. 光照和阴影优化的常见方法？

- **阴影**：使用级联阴影（CSM）、降低阴影分辨率。
- **光照**：烘焙静态光照（Lightmapping）、动态光源限制数量。

### 9. 迁移项目从内置管线到URP的注意事项？

- **材质转换**：使用`Edit > Render Pipeline > Upgrade Project Materials`工具。
- **Shader适配**：替换内置Shader为URP兼容版本（如`Universal Render Pipeline/Lit`）。
- **光照重置**：需重新烘焙光照贴图。

### 10. 如何调试自定义SRP的性能问题？

- **关键指标**：DrawCall数量、RT切换次数、Shader复杂度。
- **工具**： 

- **Frame Debugger**：逐帧分析渲染流程。
- **Profiler**：监控CPU/GPU耗时、内存占用。

### 11. DOTS（ECS）如何与SRP结合？

通过ECS的并行处理能力加速渲染数据计算（如粒子系统、大规模场景）。

使用`IJobEntity`批量处理实体渲染数据。

### 12. 未来渲染管线的发展方向？

**实时全局光照**：如光线追踪与Lumen技术。

**跨平台统一**：URP进一步优化移动端与PC的兼容性。
